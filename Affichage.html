<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Fichier de base D3</title>
    <script src="http://d3js.org/d3.v3.js" type="text/javascript"></script>
   
   
   <script type="text/javascript">
  

  var body=d3.select("body");

  d3.json("data.json",function(data){

   var data_length = data.length;
   var compteut_2010=0; 
   var compteut_2011=0;
   var compteut_2012=0;
   var compteut_2013=0;
   var compteut_2014=0;
   var compteut_2015=0;

   // On compte le nombre de crime par année

      for (var i = 0; i < data_length; i++) {
        var ch=data[i]["DateOccurred"];
        var c=ch.substr(6,4);
        if(c==2010){
            compteut_2010++;
        }else if(c==2011){
            compteut_2011++;
        }else if(c==2012){
            compteut_2012++;
        }else if(c==2013){
            compteut_2013++;
        }else if(c==2014){
            compteut_2014++;
        }else if(c==2015){
            compteut_2015++;
        }
}

    var dt=[
    {"Annee":"2010", "valeur":compteut_2010},
    {"Annee":"2011", "valeur":compteut_2011},
    {"Annee":"2012", "valeur":compteut_2012},
    {"Annee":"2013", "valeur":compteut_2013},
    {"Annee":"2014", "valeur":compteut_2014},
    {"Annee":"2015", "valeur":compteut_2015}
]
/*
//Largeur et hauteur du graphe
       var larg =500;
         var haut =200;
         var barPadding =1;//Padding des barres
        //Creation de l'élément SVG
         var svg = d3.select("body")
             .append("svg")
             .attr("width", larg)
             .attr("height", haut);
         svg.selectAll("rect")
             .data(dt)
             .enter()
             .append("rect")
             .attr("x", function(d, i){
                 return i *(60+ barPadding);//Largeur de 20 + 1 de padding
             })
             .attr("y", function(d){
                 return haut -(d.valeur *5);// Hauteur - valeur
             })
             .attr("width", 60)
             .attr("height", function(d){
                 return(d.valeur *5);// Valeur de la donnée
             })
             .attr("fill", "teal");
   */  
//})

            var larg =500;
            var haut =200;
            var barPadding =1;//Padding des barres
            var nbb = dt.length;//Nb de barres
            var lb =((larg - nbb) / nbb);//Largeur barre
            var ch =(haut / d3.max(dt, function(d){
                                                return d.valeur/100 //Coef. hauteur.
                                            }));
   
                                            
           //Creation élément SVG
            var svg = d3.select("body")
                .append("svg")
                .attr("width", larg)
                .attr("height", haut);
             
            svg.selectAll("rect")
                .data(dt)
                .enter()
                .append("rect")
                .attr("x", function(d, i){
                    return(i * lb);
                })
                .attr("y", function(d){
                    return haut -(d.valeur/100 * ch);
                })
                .attr("width", lb - barPadding)
                .attr("height", function(d){
                    return(d.valeur * ch);
                })
                .attr("fill", function(d){
                    return"rgb(0, 0, "+(d.valeur *10)+")";
                });
   
            svg.selectAll("text")
                .data(dt)
                .enter()
                .append("text")
                .text(function(d){
                    return d.valeur;
                })
                .attr("x", function(d, i){
                    return(i * lb)+ 12;
                })
                .attr("y", function(d){
                    return haut -((d.valeur/100 * ch)-12);
                })
                .attr("font-family", "sans-serif")
                .attr("font-size", "11px")
                .attr("fill", "white");      
})
</script>
</head>
<body>   
</body>
</html>